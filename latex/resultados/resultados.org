#+SETUPFILE: header.org
#+TITLE: Resultados

* Notación
*fun* = Mínimo local hallado de la función /execute\textunderscore circuit/ con el optimizador
\newline
*p* = Número de capas (a mayor número el circuito es más profundo)
\newline
*theta* = Lista de parámetros [\beta_{1}, ..., \beta_{p}, \gamma_{1}, ..., \gamma_{p}] del circuito cuántico
\newline
*num iterations* = Número de iteraciones del compilador necesarias para hallar el mínimo
\newline
*seed\textunderscore simulator* = Semilla utilizada en la ejecución del circuito para fijar la aleatoriedad en /backend.run()/
\newline
*X_{ij}* = Se refiere a la arista *i* -> *j*. 1 Si dicha arista es parte del camino resultante, 0 en otro caso
\newline
*q_n* = Qubit enésimo
\newline
q_{4}q_{3}q_{2}q_{1}q_{0} = X_{23}X_{13}X_{12}X_{02}X_{01}
\newpage

* Primer grafo
[[./img/primer_grafo.png]]
\newpage
** Aer - Versión del paper (primer\textunderscore grafo/aer-qaoa.ipynb)
Pruebas realizadas sobre la versión del código sin la restricción\newline
    *X_{13} + X_{23} = 1*\newline

Versión equivalente a la de [[[https://www.mdpi.com/1424-8220/22/19/7570/xml][Multi-Objective Routing Optimization for 6G Communication Networks Using a Quantum Approximate Optimization Algorithm-sensors-22-07570-v2]]]

- *Estadísticas:*

  Realizando la ejecución 1000 veces se han obtenido como caminos resultantes los siguientes:
  
  | / |     <> | >                  |                 > |
  |---+--------+--------------------+-------------------|
  |   | *Qubits* | *Camino*             | *Frecuencia* (1000) |
  |---+--------+--------------------+-------------------|
  |   |  10101 | X_{01}X_{12}X_{23} |               917 |
  |   |  10110 | X_{02}X_{12}X_{23} |                82 |
  |   |  01001 | X_{01}X_{13}       |                 1 |
  |---+--------+--------------------+-------------------|
\newpage

*** Caso correcto

| / | <>    | >                | >              | >                             |
|---+-------+------------------+----------------+-------------------------------|
|   | *fun*   | *theta*            | *num iterations* | *seed\textunderscore simulator* |
|---+-------+------------------+----------------+-------------------------------|
|   | 29.63 | [0.7739, 0.9302] | 29             | 10                            |
|---+-------+------------------+----------------+-------------------------------|

#+CAPTION: seed\textunderscore simulator=10
#+ATTR_LATEX: :scale 0.5
[[./img/primer_paper_aer_correcto.png]]

Mejor resultado: 10101 (q_{4}q_{3}q_{2}q_{1}q_{0} = X_{23}X_{13}X_{12}X_{02}X_{01})

Camino: X_{01}X_{12}X_{23} (Camino óptimo)

\newpage

*** Caso erróneo

| / | <>    | >                | >              | >                             |
|---+-------+------------------+----------------+-------------------------------|
|   | *fun*   | *theta*            | *num iterations* | *seed\textunderscore simulator* |
|---+-------+------------------+----------------+-------------------------------|
|   | 52.79 | [0.6320  0.7177] | 35             | 21                            |
|---+-------+------------------+----------------+-------------------------------|

#+CAPTION: seed\textunderscore simulator=21
#+ATTR_LATEX: :scale 0.5
[[./img/primer_paper_aer_erroneo.png]]

Mejor resultado: 10110 (q_{4}q_{3}q_{2}q_{1}q_{0} = X_{23}X_{13}X_{12}X_{02}X_{01})

Camino: X_{02}X_{12}X_{23} (Camino incorrecto. Rompe 2 restricciones)

Restricciones rotas: \newline
    *X_{02}+X_{12}=X_{23}* \newline
    *X_{01}=X_{12}+X_{13}* \newline

\newpage

*** Caso subóptimo

Obtenido a mano (no se ha encontrado ninguna semilla que diese este resultado)

| / | <>    | >                |
|---+-------+------------------|
|   | *fun*   | *theta*            |
|---+-------+------------------|
|   | 67.33 | [-0.4811, 1.566] |
|---+-------+------------------|

#+ATTR_LATEX: :scale 0.5
[[./img/primer_paper_aer_suboptimo.png]]

Mejor resultado: 01001 (q_{4}q_{3}q_{2}q_{1}q_{0} = X_{23}X_{13}X_{12}X_{02}X_{01})

Camino: X_{01}X_{13} (Camino subóptimo, pero no se rompe ninguna restricción)

\newpage

*** Utilizando el parámetro *theta* obtenido en el artículo
  
| / | <>    | >                         |
|---+-------+---------------------------|
|   | *fun*   | *theta*                     |
|---+-------+---------------------------|
|   | 65.40 | [0.28517317, -5.05969577] |
|---+-------+---------------------------|

#+ATTR_LATEX: :scale 0.5
[[./img/primer_paper_aer_resultado.png]]

Mejor resultado: 10101 (q_{4}q_{3}q_{2}q_{1}q_{0} = X_{23}X_{13}X_{12}X_{02}X_{01})

Camino: X_{01}X_{12}X_{23} (Camino óptimo)

La gráfica resultante es muy similar a la versión que se intenta replicar. *fun* tiene resultados muy altos, entre 65 y 70 (en comparación con la versión del código con la restricción extra).

\newpage

*** Rz(*2), Rzz(*2), Rx(*2)
#+begin_src python
  circuit.rz(coef * 2, q_idx)
  circuit.rzz(coef * gamma[p] * 2, q_idxs[0], q_idxs[1])
  circuit.rx(beta[p] * 4, q_idx)
#+end_src
  
| / |     <> | >                  |                 > |
|---+--------+--------------------+-------------------|
|   | *Qubits* | *Camino*             | *Frecuencia (1000)* |
|---+--------+--------------------+-------------------|
|   |  11010 | X_{02}X_{13}X_{23} |               845 |
|   |  11001 |                    |                88 |
|   |  01010 |                    |                 5 |
|   |  11011 |                    |                14 |
|   |  00101 |                    |                21 |
|   |  00010 |                    |                 1 |
|   |  10110 |                    |                14 |
|   |  10101 |                    |                 3 |
|   |  01001 |                    |                 5 |
|   |  10010 |                    |                 2 |
|   |  00110 |                    |                 2 |
|---+--------+--------------------+-------------------|

*** coef *= 2
#+begin_src python
  circuit.rz(2 * coef, q_idx)
  circuit.rzz(2 * coef * gamma[p], q_idxs[0], q_idxs[1])
  circuit.rx(beta[p] * 2, q_idx)
#+end_src

| / |     <> | >                  |                 > |
|---+--------+--------------------+-------------------|
|   | *Qubits* | *Camino*             | *Frecuencia (1000)* |
|---+--------+--------------------+-------------------|
|   |  11010 | X_{02}X_{13}X_{23} |               966 |
|   |  11101 |                    |                 2 |
|   |  00101 |                    |                18 |
|   |  01010 |                    |                 8 |
|   |  11001 |                    |                 3 |
|   |  00110 |                    |                 1 |
|   |  10110 |                    |                 2 |
|---+--------+--------------------+-------------------|

Da un mismo error un porcentaje de veces muy alto. Error muy fiable.

*** Coef /= 2
#+begin_src python
  circuit.rz(1/2 * coef, q_idx)
  circuit.rzz(1/2 * coef * gamma[p], q_idxs[0], q_idxs[1])
  circuit.rx(beta[p] * 2, q_idx)
#+end_src

| / | <>     | >      | >                 |
|---+--------+--------+-------------------|
|   | *Qubits* | *Camino* | *Frecuencia (1000)* |
|---+--------+--------+-------------------|
|   | 00000  |        | 1000              |
|---+--------+--------+-------------------|

\newpage

*** \beta /= 2
#+begin_src python
  circuit.rz(coef, q_idx)
  circuit.rzz(coef * gamma[p], q_idxs[0], q_idxs[1])
  circuit.rx(beta[p], q_idx)
#+end_src

| / |     <> | >       |                 > |
|---+--------+---------+-------------------|
|   | *Qubits* | *Camino*  | *Frecuencia (1000)* |
|---+--------+---------+-------------------|
|   |  10101 | _Óptimo_  |               986 |
|   |  10110 |         |                14 |
|---+--------+---------+-------------------|

#+CAPTION: Mejor resultado
#+ATTR_LATEX: :scale 0.5
[[./img/primer_paper_aer_beta-div-2.png]]

\newpage

*** \gamma /= 2
#+begin_src python
  circuit.rz(coef, q_idx)
  circuit.rzz(coef * gamma[p] / 2, q_idxs[0], q_idxs[1])
  circuit.rx(beta[p] * 2, q_idx)
#+end_src

| / | <>     | >      | >                 |
|---+--------+--------+-------------------|
|   | *Qubits* | *Camino* | *Frecuencia (1000)* |
|---+--------+--------+-------------------|
|   | 10101  | _Óptimo_ | 1000              |
|---+--------+--------+-------------------|

\newpage

*** \beta /= 2, \gamma /= 2
#+begin_src python
  circuit.rz(coef, q_idx)
  circuit.rzz(coef * gamma[p] / 2, q_idxs[0], q_idxs[1])
  circuit.rx(beta[p], q_idx)
#+end_src


- num layers = 1:
  | / | <>     | >      | >                 |
  |---+--------+--------+-------------------|
  |   | *Qubits* | *Camino* | *Frecuencia (1000)* |
  |---+--------+--------+-------------------|
  |   | 10101  | _Óptimo_ | 1000              |
  |---+--------+--------+-------------------|

- num layers = 2:
  | / |     <> | >      |                 > |
  |---+--------+--------+-------------------|
  |   | *Qubits* | *Camino* | *Frecuencia (1000)* |
  |---+--------+--------+-------------------|
  |   |  10101 |        |               960 |
  |   |  10001 |        |                28 |
  |   |  11001 |        |                12 |
  |---+--------+--------+-------------------|

- num layers = 3:
  | / |     <> | >      |                 > |
  |---+--------+--------+-------------------|
  |   | *Qubits* | *Camino* | *Frecuencia (1000)* |
  |---+--------+--------+-------------------|
  |   |  10101 |        |               565 |
  |   |  10001 |        |               111 |
  |   |  11101 |        |                87 |
  |   |    ... |        |               ... |
  |---+--------+--------+-------------------|

\newpage

*** \beta_{0} = 0.5, \gamma_{0} = 0.5

- num layers = 1:
  | / | <>     | >      | >                 |
  |---+--------+--------+-------------------|
  |   | *Qubits* | *Camino* | *Frecuencia (1000)* |
  |---+--------+--------+-------------------|
  |   | 10101  |        | 1000              |
  |---+--------+--------+-------------------|

- num layers = 2:
  | / |     <> | >      |                 > |
  |---+--------+--------+-------------------|
  |   | *Qubits* | *Camino* | *Frecuencia (1000)* |
  |---+--------+--------+-------------------|
  |   |  10101 |        |               992 |
  |   |  11001 |        |                 8 |
  |---+--------+--------+-------------------|

- num layers = 3:
  | / |     <> | >      |                 > |
  |---+--------+--------+-------------------|
  |   | *Qubits* | *Camino* | *Frecuencia (1000)* |
  |---+--------+--------+-------------------|
  |   |  10101 |        |               469 |
  |   |  11101 |        |               198 |
  |   |  11011 |        |                88 |
  |   |    ... |        |               ... |
  |---+--------+--------+-------------------|

\newpage

*** Original pero variar num layers

Al aumentar el número de capas se obtienen resultados mucho peores (tal vez esté mal implementado)
- num layers = 1: (Igual que tabla de estadisticas normal)
  | / |     <> | >      |                 > |
  |---+--------+--------+-------------------|
  |   | *Qubits* | *Camino* | *Frecuencia (1000)* |
  |---+--------+--------+-------------------|
  |   |  10101 |        |               913 |
  |   |  10110 |        |                86 |
  |   |  01001 |        |                 1 |
  |---+--------+--------+-------------------|

- num layers = 2:
  | / |     <> | >      |                 > |
  |---+--------+--------+-------------------|
  |   | *Qubits* | *Camino* | *Frecuencia (1000)* |
  |---+--------+--------+-------------------|
  |   |  10101 |        |               646 |
  |   |  10010 |        |                75 |
  |   |  10110 |        |                70 |
  |   |  10001 |        |                49 |
  |   |    ... |        |               ... |
  |---+--------+--------+-------------------|

- num layers = 3:
  | / |     <> | >      |                 > |
  |---+--------+--------+-------------------|
  |   | *Qubits* | *Camino* | *Frecuencia (1000)* |
  |---+--------+--------+-------------------|
  |   |  10101 |        |               634 |
  |   |  10010 |        |                92 |
  |   |  10001 |        |                84 |
  |   |  01001 |        |                66 |
  |   |  00000 |        |                36 |
  |---+--------+--------+-------------------|

** Aer simulator con restricción extra  (primer\textunderscore grafo/con\textunderscore restricc/aer-qaoa.ipynb)
Con respecto a la función de coste del paper se añade la restricción\newline
    *X_{13} + X_{23} = 1*\newline
Esto sería, que el camino solo llegue al nodo final *3* por una de las aristas X_{i3} existentes.

- *Estadísticas:*

Realizando la ejecución 1000 veces se han obtenido como caminos resultantes los siguientes:

| / |     <> | >                              |                 > |
|---+--------+--------------------------------+-------------------|
|   | *Qubits* | *Camino*                         | *Frecuencia (1000)* |
|---+--------+--------------------------------+-------------------|
|   |  10101 | X_{01}X_{12}X_{23}             |               938 |
|   |  11000 | X_{13}X_{23}                   |                37 |
|   |  10001 | X_{01}X_{23}                   |                 9 |
|   |  00011 | X_{01}X_{02}                   |                11 |
|   |  00100 | X_{12}                         |                 3 |
|   |  00010 | X_{02}                         |                 1 |
|   |  11111 | X_{01}X_{02}X_{12}X_{13}X_{23} |                 1 |
|---+--------+--------------------------------+-------------------|

\newpage

*** Caso correcto
| / | <>    | >                | >              | >                             |
|---+-------+------------------+----------------+-------------------------------|
|   | *fun*   | *theta*            | *num iterations* | *seed\textunderscore simulator* |
|---+-------+------------------+----------------+-------------------------------|
|   | 42.29 | [0.5081, 0.9401] | 33             | 3                             |
|---+-------+------------------+----------------+-------------------------------|

#+CAPTION: seed\textunderscore simulator=3
#+ATTR_LATEX: :scale 0.5
[[./img/primer_restr_aer_correcto.png]]

Mejor resultado: 10101 (q_{4}q_{3}q_{2}q_{1}q_{0} = X_{23}X_{13}X_{12}X_{02}X_{01})

Camino: X_{01}X_{12}X_{23} (Camino óptimo)

\newpage

*** Caso "correcto" con ruido
| / | <>    | >               | >              | >                             |
|---+-------+-----------------+----------------+-------------------------------|
|   | *fun*   | *theta*           | *num iterations* | *seed\textunderscore simulator* |
|---+-------+-----------------+----------------+-------------------------------|
|   | 90.75 | [0.9962, 1.995] | 27             | 2                             |
|---+-------+-----------------+----------------+-------------------------------|

#+CAPTION: seed\textunderscore simulator=2
#+ATTR_LATEX: :scale 0.5
[[./img/primer_restr_aer_correcto-con-ruido.png]]

Mejor resultado: 10101 (q_{4}q_{3}q_{2}q_{1}q_{0} = X_{23}X_{13}X_{12}X_{02}X_{01})

Camino: X_{01}X_{12}X_{23} (Camino óptimo)

Aunque se obtenga el resultado óptimo (10101) existen otros resultados demasiado altos, e incluso ejecutando el circuito con el mismo *theta* se dan valores distintos. Podría afectar a los resultados de las estadísticas.

Además se ve que encuentra un valor *fun* demasiado alto (90.75)

\newpage

** Provider
- ibmq\textunderscore lima
#+CAPTION: num iterations=2
#+ATTR_LATEX: :scale 0.4
[[./img/primer_provider_iter-2.png]]
Solo para comprobar que funciona la ejecución.
